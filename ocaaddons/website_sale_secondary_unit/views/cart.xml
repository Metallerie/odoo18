<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="cart_lines_secondary_unit_readonly"
            inherit_id="website_sale.cart_lines"
            name="Cart lines - secondary unit readonly">

    <!-- Remplacer le bloc quantité (le +/- et l'input) si unité secondaire -->
    <xpath expr="//div[@name='website_sale_cart_line_quantity']" position="replace">
      <div class="d-flex flex-column align-items-end">
        <t t-if="line.secondary_uom_id">
          <!-- Affichage readonly en unité secondaire -->
          <div class="mb-2">
            <strong>Quantité :</strong>
            <span t-out="line.secondary_uom_qty"/>
            <span t-out="line.secondary_uom_id.uom_id.sudo().name"/>
          </div>

          <!-- Conversion affichée en petit -->
          <div class="text-muted small mb-2">
            ≈ <span t-out="line.product_uom_qty"/>
            <span t-out="line.product_uom.sudo().name"/>
          </div>

          <div class="text-muted small">
            Pour modifier, supprime la ligne et retourne sur la fiche produit.
          </div>

          <!-- On garde un input caché pour que le panier fonctionne -->
          <input type="hidden"
                 class="js_quantity quantity form-control"
                 t-att-data-line-id="line.id"
                 t-att-data-product-id="line.product_id.id"
                 t-att-value="line._get_displayed_quantity()"/>
        </t>

        <t t-else="">
          <!-- Cas normal : on remet le bloc d'origine -->
          <div t-attf-class="css_quantity input-group mb-2" name="website_sale_cart_line_quantity">
            <t t-if="not line._is_not_sellable_line()">
              <t t-if="show_qty">
                <a href="#" class="js_add_cart_json btn btn-link d-inline-block border-end-0" aria-label="Remove one" title="Remove one">
                  <i class="position-relative z-1 fa fa-minus"/>
                </a>
                <input type="text" class="js_quantity quantity form-control border-start-0 border-end-0"
                       t-att-data-line-id="line.id"
                       t-att-data-product-id="line.product_id.id"
                       t-att-value="line._get_displayed_quantity()"/>
                <t t-if="line._get_shop_warning(clear=False)">
                  <a href="#" class="btn btn-link">
                    <i class="fa fa-warning text-warning" t-att-title="line._get_shop_warning()" role="img" aria-label="Warning"/>
                  </a>
                </t>
                <a t-else="" href="#" class="js_add_cart_json d-inline-block float_left btn btn-link border-start-0" aria-label="Add one" title="Add one">
                  <i class="fa fa-plus position-relative z-1"/>
                </a>
              </t>
              <t t-else="">
                <input type="hidden" class="js_quantity form-control quantity"
                       t-att-data-line-id="line.id"
                       t-att-data-product-id="line.product_id.id"
                       t-att-value="line._get_displayed_quantity()"/>
              </t>
            </t>
            <t t-else="">
              <span class="w-100 text-muted" t-esc="int(line.product_uom_qty)"/>
              <input type="hidden" class="js_quantity quantity form-control"
                     t-att-data-line-id="line.id"
                     t-att-data-product-id="line.product_id.id"
                     t-att-value="line._get_displayed_quantity()"/>
            </t>
          </div>
        </t>
      </div>
    </xpath>

  </template>
</odoo>
