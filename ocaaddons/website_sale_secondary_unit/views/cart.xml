<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="cart_lines_secondary_unit_readonly"
            inherit_id="website_sale.cart_lines"
            name="Cart lines - secondary unit readonly">

    <!-- 1) Injecte un bloc readonly AVANT le bloc quantité standard -->
    <xpath expr="//div[@name='website_sale_cart_line_quantity']" position="before">
      <t t-if="line.secondary_uom_id">
        <div class="mb-2">
          <strong>Quantité :</strong>
          <span t-out="line.secondary_uom_qty"/>
          <span t-out="line.secondary_uom_id.uom_id.name"/>
        </div>
        <div class="text-muted small mb-2">
          ≈ <span t-out="line.product_uom_qty"/>
          <span t-out="line.product_uom.sudo().name"/>
        </div>
        <div class="text-muted small">
          Pour modifier, supprime la ligne et retourne sur la fiche produit.
        </div>
      </t>
    </xpath>

    <!-- 2) Cache la quantité standard si unité secondaire -->
    <xpath expr="//div[@name='website_sale_cart_line_quantity']//t[@t-if='show_qty']" position="attributes">
      <attribute name="t-if">show_qty and not line.secondary_uom_id</attribute>
    </xpath>

    <!-- 3) Unité standard affichée seulement si pas d'unité secondaire -->
    <xpath expr="//div[@name='website_sale_cart_line_quantity']" position="after">
      <t t-if="not line.secondary_uom_id">
        <div class="mb-2">
          <span t-out="line.product_uom.sudo().name"/>
        </div>
      </t>
    </xpath>

  </template>
</odoo>
